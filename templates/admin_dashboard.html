{% extends "base.html" %}

{% block title %}Admin Dashboard - Smart Canteen{% endblock %}

{% block navbar %}
<nav class="navbar">
    <div class="nav-container">
        <div class="nav-brand">
            <h2>KGiSL Smart Canteen - Admin</h2>
        </div>
        <button class="nav-toggle" id="navToggle" aria-label="Toggle navigation">
            <span></span>
            <span></span>
            <span></span>
        </button>
        <div class="nav-menu" id="navMenu">
            <a href="{{ url_for('admin_dashboard') }}" class="nav-link active">Overview</a>
            <a href="{{ url_for('admin_menu') }}" class="nav-link">Menu</a>
            <a href="{{ url_for('admin_orders') }}" class="nav-link">Orders</a>
            <a href="{{ url_for('admin_analytics') }}" class="nav-link">Analytics</a>
            <div class="nav-user">
                <span class="username-display">Admin</span>
                <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline">Logout</a>
            </div>
        </div>
    </div>
</nav>
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="stats">
        <div class="stat-card">
            <h3>Total Users</h3>
            <p>{{ total_users }}</p>
        </div>
        <div class="stat-card">
            <h3>Menu Items</h3>
            <p>{{ total_menu_items }}</p>
            <small class="stat-breakdown">
                <span class="available-count">{{ available_menu_items }} Available</span>
                <span class="unavailable-count">{{ unavailable_menu_items }} Unavailable</span>
            </small>
        </div>
        <div class="stat-card">
            <h3>Total Orders</h3>
            <p>{{ total_orders }}</p>
        </div>
        <div class="stat-card">
            <h3>Total Revenue</h3>
            <p>₹{{ "%.2f"|format(total_revenue) }}</p>
        </div>
        <div class="stat-card">
            <h3>Uncompleted Orders</h3>
            <p>{{ uncompleted_orders }}</p>
        </div>
    </div>
    
    <div class="recent-orders">
        <h3>Recent Orders</h3>
        {% if recent_orders %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>User</th>
                        <th>Items</th>
                        <th>Total</th>
                        <th>Status</th>
                        <th>Time</th>
                    </tr>
                </thead>
            <tbody>
                {% for order in recent_orders %}
                <tr>
                    <td>{{ order.order_id }}</td>
                    <td>{{ order.customer.username }}</td>
                    <td>{{ order.order_items|length }} items</td>
                    <td>₹{{ "%.2f"|format(order.total_amount) }}</td>
                    <td><span class="status-badge status-{{ order.status.lower() }}">{{ order.status }}</span></td>
                    <td>{{ order.timestamp.strftime('%b %d %H:%M') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>
        {% else %}
        <p>No recent orders.</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Mobile Navigation Toggle
document.addEventListener('DOMContentLoaded', function() {
    const navToggle = document.getElementById('navToggle');
    const navMenu = document.getElementById('navMenu');
    
    if (navToggle && navMenu) {
        navToggle.addEventListener('click', function() {
            navToggle.classList.toggle('active');
            navMenu.classList.toggle('active');
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(e) {
            if (!navToggle.contains(e.target) && !navMenu.contains(e.target)) {
                navToggle.classList.remove('active');
                navMenu.classList.remove('active');
            }
        });
        
        // Close menu when window is resized to desktop
        window.addEventListener('resize', function() {
            if (window.innerWidth > 768) {
                navToggle.classList.remove('active');
                navMenu.classList.remove('active');
            }
        });
    }
});
</script>
{% endblock %}
